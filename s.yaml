# ------------------------------------
#   欢迎您使用阿里云函数计算 FC 组件进行项目开发
#   组件仓库地址/帮助文档：https://github.com/devsapp/fc
#   Yaml参考文档：https://github.com/devsapp/fc/blob/jiangyu-docs/docs/zh/yaml.md
#   关于：
#      - Serverless Devs和FC组件的关系、如何声明/部署多个函数、超过50M的代码包如何部署
#      - 关于.fcignore使用方法、工具中.s目录是做什么、函数进行build操作之后如何处理build的产物
#   等问题，可以参考文档：https://github.com/devsapp/fc/blob/jiangyu-docs/docs/zh/tips.md
#   关于如何做CICD等问题，可以参考：https://github.com/Serverless-Devs/Serverless-Devs/blob/master/docs/zh/cicd.md
#   有问题快来钉钉群问一下吧：33947367
# ------------------------------------

edition: 1.0.0
name: DeathNote
access: default

vars: # 全局变量
  region: cn-hangzhou
  service:
    name: DeathNote-service
    description: 'DeathNote'
    logConfig: auto

services:
  helloworld: # 业务名称/模块名称
    component: fc
    actions: # 自定义执行逻辑
      pre-deploy: # 在deploy之前运行
        - run: s build --custom-args ' --registry https://registry.npm.taobao.org'	# 要运行的命令行
          path: ./ # 命令行运行的路径
      # post-deploy: # 在deploy之后运行
      #   - run: s versions   # 要运行的命令行
      #     path: ./ # 命令行运行的路径
    props: #  组件的属性值
      region: ${vars.region}
      service: ${vars.service}
      function:
        name: DeathNote-function
        description: 'DeathNote'
        runtime: nodejs14
        codeUri: ./
        handler: index.handler
        instanceConcurrency: 15
        environmentVariables:
          trdaCookie: ${env(trdaCookie)}
          chinaUnicomCookie: ${env(chinaUnicomCookie)}
          yingsheng_data: ${env(yingsheng_data)}
          akrd: ${env(akrd)}
          qcsAuthorization: ${env(qcsAuthorization)}
          qcsunionId: ${env(qcsunionId)}
          xqzck: ${env(xqzck)}
          jtbhapp: ${env(jtbhapp)}
          nhsy_data: ${env(nhsy_data)}
          suboer_wx: ${env(suboer_wx)}
          yingshengAccount: ${env(yingshengAccount)}
          dtCookie: ${env(dtCookie)}
          sfsyUrl: ${env(sfsyUrl)}
          txsCookie: ${env(txsCookie)}
          lbvip: ${env(lbvip)}
        asyncConfiguration:
          maxAsyncRetryAttempts: 0
        memorySize: 128
        timeout: 3000
      triggers:
        - name: trdaDraw
          type: timer
          config:    
            payload: 'trdaDraw'
            cronExpression: 'CRON_TZ=Asia/Shanghai 0 46 6,18 * * *'    
            enable: true
        - name: chinaUnicom
          type: timer
          config:    
            payload: 'chinaUnicom'
            cronExpression: 'CRON_TZ=Asia/Shanghai 0 48 1,7,20 * * *'    
            enable: true
        - name: ys
          type: timer
          config:    
            payload: 'ys'
            cronExpression: 'CRON_TZ=Asia/Shanghai 30 10 15 * * *'    
            enable: true
        - name: akrd
          type: timer
          config:    
            payload: 'akrd'
            cronExpression: 'CRON_TZ=Asia/Shanghai 30 11 9,18 * * *'    
            enable: true
        - name: qcs
          type: timer
          config:    
            payload: 'qcs'
            cronExpression: 'CRON_TZ=Asia/Shanghai 30 5 10 * * *'    
            enable: true
        - name: xqz
          type: timer
          config:    
            payload: 'xqz'
            cronExpression: 'CRON_TZ=Asia/Shanghai 30 5 8 * * *'    
            enable: true
        - name: jtbh
          type: timer
          config:    
            payload: 'jtbh'
            cronExpression: 'CRON_TZ=Asia/Shanghai 30 5 10 * * *'    
            enable: true
        - name: nhsy
          type: timer
          config:    
            payload: 'nhsy'
            cronExpression: 'CRON_TZ=Asia/Shanghai 30 4 10,20 * * *'    
            enable: true
        - name: suboer
          type: timer
          config:    
            payload: 'suboer'
            cronExpression: 'CRON_TZ=Asia/Shanghai 30 5 15 * * *'    
            enable: true
        - name: config
          type: timer
          config:    
            payload: 'config'
            cronExpression: '@every 60m'    
            enable: true